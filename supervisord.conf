[unix_http_server]
file=/var/run/supervisor.sock   ; Path to the socket file
chmod=0700                      ; Socket file permissions (root only)
;chown=nobody:nogroup           ; Optional: Change ownership if not running as root

[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
user=root

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:app]
process_name=%(program_name)s_%(process_num)02d
command=python3 /app/app.py
directory=/app
autostart=true
autorestart=true
user=root
numprocs=1
redirect_stderr=true
stdout_logfile=/app/logs/app.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stopwaitsecs=21800
startretries=3  ; Limit retries to 3 (default is 3, but make it explicit)
startsecs=5     ; Wait 5 seconds before considering it "started"
loglevel=info

[program:whisper]
process_name=%(program_name)s_%(process_num)02d
command=bash /app/whisper_queue.sh
autostart=true
autorestart=true
user=root
numprocs=1
redirect_stderr=true
stdout_logfile=/app/logs/whisper.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stopwaitsecs=21800
loglevel=info

; ---- ADD THIS WATCHDOG PROGRAM DEFINITION ----
[program:gpu-watchdog]
process_name=%(program_name)s_%(process_num)02d
command=bash /app/gpu_watchdog.sh
autostart=true
autorestart=true
user=root
numprocs=1
redirect_stderr=true
stdout_logfile=/app/logs/gpu_watchdog.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stopwaitsecs=5
loglevel=info
